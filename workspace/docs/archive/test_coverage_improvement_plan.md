# テストカバレッジ改善計画

**作成日時:** 2026-02-01
**対象バージョン:** v1.0 → v1.1
**現在カバレッジ:** ~65%
**目標カバレッジ:** 85%+

## 現状分析

### 強み
- Ed25519署名検証: 実装済・テスト済
- X25519鍵交換: 実装済・テスト済
- AES-256-GCM暗号化: 実装済・テスト済
- JWT認証: 実装済・テスト済
- リプレイ攻撃防止: 実装済・テスト済

### カバレッジギャップ

| モジュール | 現在 | 目標 | 優先度 |
|-----------|------|------|--------|
| peer_service.py | ~60% | 85% | High |
| session_manager.py | ~40% | 80% | High |
| chunked_transfer.py | ~30% | 75% | Medium |
| distributed_registry.py | ~20% | 70% | Medium |
| api_server.py | ~70% | 85% | Medium |

## 短期改善計画 (S3-S5)

### S3: Session Management テスト追加
- SessionInfo ライフサイクルテスト
- セッションタイムアウト処理テスト
- セッションパージ処理テスト
- 並行セッション管理テスト

### S4: Sequence Number テスト追加
- シーケンス番号検証ロジックテスト
- 重複メッセージ検出テスト
- 順序外メッセージ処理テスト
- シーケンスリセット処理テスト

### S5: Handshake Protocol テスト追加
- HandshakeChallenge 生成テスト
- X25519 ハンドシェイクフローテスト
- ハンドシェイク失敗時の挙動テスト
- ハンドシェイクタイムアウトテスト

## 中期改善計画 (M1-M3)

### M1: コード品質改善
- peer_service.py モジュール分割
- 型ヒントの完全な追加
- ドキュメントの充実化

### M2: CI/CD 整備
- GitHub Actions ワークフロー作成
- 自動テスト実行設定
- カバレッジレポート自動生成

### M3: セキュリティテスト強化
- レート制限テスト
- DoS攻撃耐性テスト
- 不正メッセージ処理テスト

## 実装ロードマップ

Week 1-2: S3 (Session Management)
Week 3-4: S4 (Sequence Number)
Week 5-6: S5 (Handshake Protocol)
Week 7-8: M1 (コード品質)
Week 9-10: M2 (CI/CD)
Week 11-12: M3 (セキュリティ)

## 成功指標

| 指標 | 現在 | 目標 | 期限 |
|------|------|------|------|
| 総合カバレッジ | 65% | 85% | 3ヶ月 |
| クリティカルパスカバレッジ | 75% | 95% | 2ヶ月 |
| CI/CD自動化率 | 0% | 100% | 2ヶ月 |

## 推奨アクション

即座に実行:
1. session_manager.py のテストケース追加開始
2. GitHub Actions 設定ファイル作成

次のステップ:
- @coder に session_manager テスト実装を委譲
