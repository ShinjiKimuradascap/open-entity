[pytest]
asyncio_mode = auto
testpaths = services tests
cache_dir = .pytest_cache

# Parallel execution with xdist
addopts = -v --tb=short --strict-markers -n auto

# Test categories
markers =
    # Test levels
    unit: Unit tests (fast, isolated, no external deps)
    integration: Integration tests (medium speed, service interactions)
    e2e: End-to-end tests (slow, full system testing)
    stress: Stress/load tests
    smoke: Smoke tests (quick health check)
    
    # Component categories
    crypto: Cryptography related tests
    session: Session management tests
    peer: Peer service tests
    handshake: Handshake protocol tests
    dht: DHT/registry tests
    network: Network/peer communication tests
    wallet: Wallet tests
    api: API server tests
    task: Task delegation tests
    token: Token/economy tests
    
    # Special categories
    security: Security focused tests
    regression: Regression tests
    slow: Tests that take longer than 1 second
    fast: Tests that complete in less than 100ms
    moltbook: Moltbook-related tests

# Coverage settings (when --cov is used)
[coverage:run]
source = services
omit = 
    */test_*.py
    */tests/*
    */venv/*
    */node_modules/*

[coverage:report]
exclude_lines =
    pragma: no cover
    def __repr__
    raise AssertionError
    raise NotImplementedError
    if __name__ == .__main__.:
    if TYPE_CHECKING:
